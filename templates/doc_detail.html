<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{{ document.title }}</title>
    <link rel="stylesheet" href="/static/css/frame/bootstrap.css">
    <link rel="stylesheet" href="/static/css/detail.css">
</head>
<body>

<main class="main-content">
    <div class="border-bottom">
        <h1 class="detail-title" document-id="{{ document.id }}" document-classification="{{ document.classification }}">{{ document.title }}</h1>
    </div>
    <div class="border-bottom">
        <ul class="detail-author-list">
            <li class="detail-label">Authors:</li>
            {% for author in document.get_authors %}
            <li class="detail-author-item">{{ author }},</li>
            {% endfor %}
        </ul>
    </div>
    <div class="border-bottom">
        <span class="detail-label">Publication:</span>
        <span class="detail-dot-separator">
            <span class="detail-publication">{{ document.publication }}</span>
        </span>
        <span class="detail-dot-separator">
            <span class="detail-doc-url">{{ document.doi_url }}</span>
        </span>
    </div>

    <div class="abstract-container">
        <div class="detail-block-title">
            <h2 class="detail-section-label">
                Abstract
            </h2>
        </div>
        <div class="abstract-section">
            <p>{{ document.abstract }}</p>
        </div>
    </div>
    <div class="reference-container">
        <div class="detail-block-title">
            <h2 class="detail-section-label">
                References
            </h2>
        </div>
        <ol class="reference-list">
            {% for reference in document.get_references %}
            <li class="reference-item">
                <span class="reference-note">{{ reference }}</span>
            </li>
            {% endfor %}
        </ol>
    </div>
</main>
<div class="detail-bottom">
    <h1>反馈相关性:(0-1)</h1>
    <input id="user_relevance" type="text">
    {% csrf_token %}
    <button type="button" onclick="submit_relevance()">反馈</button>
</div>

<script type="text/javascript" src="/static/js/frame/jquery.min.js"></script>
<script type="text/javascript" src="/static/js/frame/bootstrap.js"></script>
<script type="text/javascript">
    function submit_relevance() {
        /*$.ajax({
            url: "/doc_browse/detail/document_id/session_id/",
            type: "post",
            data: {
                "csrfmiddlewaretoken": $("input[name='csrfmiddlewaretoken']")[0].getAttribute("value"),
                "user_relevance": parseFloat($("#user_relevance").val()),
            },
            dataType: "json",
            success: function (result) {
                // 未实现
            }
        });
        */
        let user_relevance = parseFloat($('#user_relevance').val());
        let title = $('.detail-title')[0];
        let document_id = parseFloat(title.getAttribute("document-id"));
        let document_classification = parseInt(title.getAttribute("document-classification"));

        let session_relevance = localStorage.getItem("session_relevance");
        if (session_relevance == null)
            session_relevance = new Map();
        else
            session_relevance = JSON.parse(session_relevance);
        session_relevance[document_id] = {classification: document_classification, relevance: user_relevance};
        localStorage.setItem("session_relevance", JSON.stringify(session_relevance));
    }
</script>
</body>
</html>